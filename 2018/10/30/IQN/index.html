<!DOCTYPE html>
<html lang="kr">

<!-- Head tag -->
<head>

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="RLKorea 블로그">
    

    <!--Author-->
    
        <meta name="author" content="Bomi Yu">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Implicit Quantile Networks for Distributional Reinforcement Learning"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="RLKorea 블로그" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="RLKorea"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Implicit Quantile Networks for Distributional Reinforcement Learning - RLKorea</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/monokai-sublime.min.css">
    <link rel="stylesheet" href="/css/customizing.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-125432253-1', 'auto');
        ga('send', 'pageview');

    </script>



    <!-- favicon -->
    
    <link rel="icon" href="/img/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
	
</head>


<body>

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Menu -->
    <!-- Navigation -->
<div class="custom-nav">
	<div class="menu-icon">
		<button>
			<span class="bar"></span>
			<span class="bar"></span>
			<span class="bar"></span>			
		</button>
	</div>
	<a class="logo" href="/">RLKorea</a>

</div>	

<div class="left-side on" id="bs-example-navbar-collapse-1">
	<button class="close">
		<span class="bar"></span>
		<span class="bar"></span>
	</button>
	<div class="intro">
		<a href="/"><img src="/img/logo.png" alt="내사진"></a>
		<p><i class="fa fa-facebook"></i><a href="https://www.facebook.com/groups/ReinforcementLearningKR/"><strong> RLKorea</strong></a><br>
			RLKorea 블로그</p>
	</div>
	<ul>
		<!--<li><a href="/2018/05/16/RLKorea_intro/">RLKorea소개</a></li> -->
		<li class="more_btn">
			<p class="clearfix">
			    <span class="left">
			        프로젝트
			    </span>
			    <i class="fa fa-sort-down right"></i>
			</p>
			<ul>
				<li><a href="/2018/06/29/0_pg-travel-guide/">피지여행</a></li>
				<li><a href="/tags/알파오목/">알파오목</a></li>
				<li><a href="/2018/09/27/Distributional_intro/">Dist_RL</a></li>
				<li><a href="/2018/11/20/robot_arm_intro/">각잡고로봇팔</a></li>
				<li><a href="/2019/01/22/0_lets-do-irl-guide/">GAIL하자!</a></li>
				<!--<li><a href="/tags/홈네비/">홈네비</a></li>
				<li><a href="/tags/DQN 뽀개기/">DQN 뽀개기</a></li>
				<li><a href="/tags/광산깨기/">광산깨기</a></li>-->
			</ul>
		</li>
		<li class="more_btn"><a href="#">논문리뷰</a></li>
		<li class="more_btn"><a href="#">강화학습 관련 컨텐츠</a></li>
		<li class="more_btn"><a href="#">강화학습 관련 Q&A</a></li>
		<!-- 
			<li>
				<a href="/">
					
						Home
					
				</a>
			</li>
		
			<li>
				<a href="/archives">
					
						Archives
					
				</a>
			</li>
		
			<li>
				<a href="/tags">
					
						Tags
					
				</a>
			</li>
		
			<li>
				<a href="/categories">
					
						Categories
					
				</a>
			</li>
		
			<li>
				<a href="https://github.com/reinforcement-learning-kr">
					
						<i class="fa fa-github fa-stack-2x"></i>
					
				</a>
			</li>
		 -->
	</ul>
</div>



    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header post">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<div class="post-heading">
					<h1>Implicit Quantile Networks for Distributional Reinforcement Learning</h1>
					
					<h2 class="post-subheading">
						Distributional RL 3번째 논문
					</h2>
					
					<span class="meta">
						<!-- Date and Author -->
						
							Posted by 민규식 on
						
						
							2018-10-30
						
					</span>
				</div>
			</div>
		</div>
	</div>
</header>

<!-- Post Content -->
<article>
	<div class="container">
		<div class="row">

			<!-- Tags and categories -->
		   
				<div class="col-lg-5 col-lg-offset-2 col-md-6 col-md-offset-1 post-tags">
					
						


<a href="/tags/논문/">#논문</a> <a href="/tags/Distributional-RL/">#Distributional RL</a> <a href="/tags/IQN/">#IQN</a>


					
				</div>
				<div class="col-lg-3 col-md-4 post-categories">
					
						

<a href="/categories/논문-정리/">논문 정리</a>

					
				</div>
			

			<!-- Gallery -->
			

			<!-- Post Main Content -->
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<center> <img src="https://www.dropbox.com/s/mmxtgylh0ntatp4/IQN_paper.png?dl=1" width="800"> </center>

<p>논문 저자 : <a href="https://arxiv.org/search/cs?searchtype=author&amp;query=Dabney%2C+W" target="_blank" rel="noopener">Will Dabney</a>, <a href="https://arxiv.org/search/cs?searchtype=author&amp;query=Ostrovski%2C+G" target="_blank" rel="noopener">Georg Ostrovski</a>, <a href="https://arxiv.org/search/cs?searchtype=author&amp;query=Silver%2C+D" target="_blank" rel="noopener">David Silver</a>, <a href="https://arxiv.org/search/cs?searchtype=author&amp;query=Munos%2C+R" target="_blank" rel="noopener">Rémi Munos</a><br>논문 링크 : <a href="https://arxiv.org/abs/1806.06923" target="_blank" rel="noopener">ArXiv</a><br>Proceeding : The 36th International Conference on Machine Learning (<em>ICML 2018</em>)<br>정리 : 민규식</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>본 게시물은 2018년 6월에 발표된 논문 <a href="https://arxiv.org/abs/1806.06923" target="_blank" rel="noopener">Implicit Quantile Networks for Distributional Reinforcement Learning</a> 의 내용에 대해 설명합니다.</p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/mmxtgylh0ntatp4/IQN_paper.png?dl=1" alt="paper" style="width: 800px;"><br><br> </p>

<p><br></p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><p>IQN의 경우 QR-DQN과 비교했을 때 크게 다음의 2가지 정도에서 차이를 보입니다. </p>
<ul>
<li>동일한 확률로 나눈 Quantile을 이용하는 대신 확률들을  random sampling하고 해당하는 support를 도출</li>
<li>네트워크 구조</li>
</ul>
<p>위의 내용들에 대해 하나하나 살펴보도록 하겠습니다. </p>
<p><br></p>
<h3 id="1-Sampling"><a href="#1-Sampling" class="headerlink" title="1. Sampling"></a>1. Sampling</h3><h4 id="QR-DQN-vs-IQN"><a href="#QR-DQN-vs-IQN" class="headerlink" title="QR-DQN vs IQN"></a>QR-DQN vs IQN</h4><p>QR-DQN 논문에서는 quantile regression 기법을 이용하여 Wasserstein distance를 줄이는 방향으로 분포를 학습하였고 이에 따라 distributional RL의 수렴성을 증명하였습니다. 이에 따라 IQN 논문에서도 quantile regression 기법을 그대로 이용합니다. 심지어 QR-DQN 논문에서 사용한 Quantile huber loss도 그대로 사용합니다. Target network, experience replay, epsilon-greedy도 QR-DQN과 동일하게 사용합니다. 하지만 IQN에서는 <code>Cumulative Distribution Function</code>을 동일한 확률로 나누는 대신 random sampling을 통해 취득한 tau에 해당하는 support를 도출합니다. </p>
<p>예를 들어보겠습니다. Quantile의 수를 4라고 해보겠습니다. 이 경우 QR-DQN의 quantile값은 [0.25, 0.5, 0.75, 1]이지만 QR-DQN은 Wasserstein distance를 최소로 하기 위해 quantile의 중앙값에 해당하는 support를 도출합니다. 즉 [0.125, 0.375, 0.625, 0.875]에 해당하는 support들을 추정합니다. </p>
<p>하지만 IQN 논문에서는 quantile값 tau를 0~1 사이에서 임의로 sampling합니다. Quantile이 4개인 경우 랜덤하게 추출한 0~1사이의 4개의 값이 [0.12, 0.32, 0.78, 0.92] 라고 해보겠습니다. </p>
<p> 위의 예시를 그림으로 표현한 것이 아래와 같습니다. </p>
<p align="center"><br><img src="https://www.dropbox.com/s/pffm77vus3k4uex/qr_dqn_iqn.png?dl=1" alt="QRDQN vs IQN" width="800"><br><br></p>

<p>해당 내용에 대해서는 논문에서 나타낸 그림이 굉장히 잘 표현하고 있습니다. 이 그림의 경우 DQN, C51, QR-DQN, IQN의 경우를 아래와 같이 모두 비교하고 있습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/unsy98e3xmz4a5n/compare_paper.png?dl=1" alt="Comparison from paper" width="800"><br><br></p>

<p>다들 network 구조에도 차이가 존재하지만 일단은 output만을 비교해보도록 하겠습니다. </p>
<ul>
<li>DQN: 각 action에 대한 value</li>
<li>C51: 각 action에 대한 value distribution 중 확률 (support는 고정값으로 사용)</li>
<li>QR-DQN: 각 action에 대한 value distribution 중 support (확률은 고정값으로 사용)</li>
<li>IQN: 각 action에 대한 value distribution 중 support (확률은 random sampling)</li>
</ul>
<p>그럼 이렇게 sampling을 한 tau를 통해 support를 추정하는 것은 어떤 좋은 점이 있을까요? 논문에 따르면 <code>Risk-Sensitive</code>하게 Policy를 선택할 수 있습니다. 해당 내용에 대해 한번 살펴보도록 하겠습니다.  </p>
<h4 id="Risk-Sensitive-Reinforcement-Learning"><a href="#Risk-Sensitive-Reinforcement-Learning" class="headerlink" title="Risk-Sensitive Reinforcement Learning"></a>Risk-Sensitive Reinforcement Learning</h4><p>일단은 여기서 말하는 <code>Risk</code>가 무엇을 의미하는지 먼저 알아보도록 하겠습니다. </p>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/vvlartdbmh51n69/risk_sensitive1.png?dl=1" alt="Risk sensitive1" width="600"><br><br></p>

<p>위의 그림을 보시면 2개의 action에 대한 value distribution이 각각 존재합니다. Action 1 (a1)에 대한 distribution은 분산이 작기 때문에 평균값에 가까운 return을 받을 확률이 높습니다. 하지만 value distribution의 기대값이 action2 (a2)보다 작습니다. Distributional RL에서는 distribution의 기대값을 비교하여 action을 선택하기 때문에 이런 경우 a2가 선택될 것입니다. </p>
<p>a2의 경우 분산이 매우 큰 distribution입니다. 이런 분포에서는 경우에 따라 매우 작은 return이 도출될 수도 있고, 매우 높은 return이 도출될수도 있습니다. Distributional RL에서는 이렇게 분산이 커서 결과에 대한 확신이 낮은 경우 <strong>“Risk가 크다”</strong>고 합니다. 반대로 결과에 대한 확신이 상대적으로 높은 a1의 경우 a2에 비해 <strong>“Risk가 작다”</strong>라고 할 수 있는 것이죠. </p>
<p>Sampling을 통해 학습을 수행하고 action을 선택하는 경우 이 risk에 따라 action을 선택하는 것이 가능합니다. 이런 risk sensitive policy에는 다음의 2가지가 있습니다. </p>
<ul>
<li>Risk-averse policy</li>
<li>Risk-seeking policy </li>
</ul>
<p><br></p>
<p><a href="http://www.jmlr.org/papers/volume16/garcia15a/garcia15a.pdf" target="_blank" rel="noopener">A Comprehensive Survey on Safe Reinforcement Learning</a> 논문을 보시면 다음과 같은 내용이 나옵니다.  </p>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/xivtpfaufuaf732/risk_sensitive_criterion.png?dl=1" alt="Risk sensitive criterion" width="800"><br><br></p>

<p>위의 definition을 보시면 scalar parameter beta를 통해 risk의 level을 결정합니다. 이 beta를 risk sensitivity parameter라고 합니다. 이 beta가 0보다 큰 경우 risk-averse, 0보다 작은 경우 risk-seeking, 그리고 0인 경우 risk-neutral policy가 됩니다. </p>
<p>어떻게 beta를 통해 risk의 level을 결정할 수 있는지, sampling을 이용하면 어떻게 risk-sensitive policy를 결정할 수 있는지 한번 알아보겠습니다.  </p>
<p>우선 risk-sensitive policy에 따라 action을 선택하는 식은 다음과 같습니다.  </p>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/cw6uk13z25bzhgu/risk_sensitive_equation.png?dl=1" alt="Risk sensitive criterion" width="600"><br><br></p>

<p align="center"><br><br><img src="https://www.dropbox.com/s/jtvk920xe5ubqs7/risk_averse.png?dl=1" alt="Risk averse" width="800"><br><br></p>

<p>위의 경우는 RIsk-averse 입니다. 기존의 경우 a2의 distribution에 대한 평균값이 a1의 distribution에 대한 평균값보다 크기 때문에 a2를 최종적인 action으로 선택했을 것입니다. 하지만 a1보다 a2의 분산이 훨씬 크기 때문에 beta가 양수인 경우 (distribution의 평균) - beta * (distribution의 분산)의 계산을 수행하면 연산의 결과값은 a2보다 a1이 더 큽니다. 이에 따라 risk가 더 낮은 a1을 선택하게 되는 것이고 위와 같은 과정을 통해 risk-averse policy에 따라 action을 선택하게 됩니다.   </p>
<p>CDF의 낮은 영역에서만 tau를 sampling하는 경우 위와 유사한 결과를 확인할 수 있습니다. Tau를 낮은 범위 내에서 sampling하는 경우 낮은 value들에 대한 tau들이 sampling되지만 a2의 경우 a1보다 분산이 훨씬 크기 때문에 sampling 된 결과들의 기대값은 a1이 a2보다 크게 됩니다. </p>
<p>Risk-seeking의 경우 위의 risk-averse와 반대의 상황을 확인할 수 있습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/19q9zx7o8b4npj7/risk_seeking.png?dl=1" alt="Risk seeking" width="800"><br><br></p>

<p>위의 경우는 RIsk-seeking 입니다. 기존의 경우 a1의 distribution에 대한 평균값이 a2의 distribution에 대한 평균값보다 크기 때문에 a1를 최종적인 action으로 선택했을 것입니다. 하지만 a1보다 a2의 분산이 훨씬 크기 때문에 beta가 음수인 경우 (distribution의 평균) - beta * (distribution의 분산)의 계산을 수행하면 연산의 결과값은 a1보다 a2가 더 큽니다. 이에 따라 risk가 더 큰 a2를 선택하게 되는 것이고 위와 같은 과정을 통해 risk-seeking policy에 따라 action을 선택하게 됩니다.   </p>
<p>CDF의 높은 영역에서만 tau를 sampling하는 경우 위와 유사한 결과를 확인할 수 있습니다. Tau를 높은 범위 내에서 sampling하는 경우 높은 value들에 대한 tau들이 sampling되지만 a2의 경우 a1보다 분산이 훨씬 크기 때문에 sampling 된 결과들의 기대값은 a2가 a1보다 크게 됩니다. </p>
<p><br></p>
<p>논문에서는 다음과 같은 4가지 기법들을 이용해 tau를 위한 sampling distribution을 변경하고 다양한 risk-sensitive policy를 선택하게 됩니다. </p>
<ul>
<li>Cumulative Probability Weighting (CPW)</li>
<li>Wang</li>
<li>Power formula (POW)</li>
<li>Conditional Value-at-Risk (CVaR)</li>
</ul>
<p>위의 예시 중에 가장 간단한 CVaR에 대해서 살펴보도록 하겠습니다. CVaR의 수식은 다음과 같습니다. </p>
<p> <img src="https://www.dropbox.com/s/3bvwmom4ky6pmhp/CVaR.png?dl=1" alt="CVar" width="300"></p>
<p>원래 tau는 [0,1] 중에서 uniform한 확률로 선택합니다. 하지만 위의 경우 eta를 예를 들어 0.25로 하면 0.25tau가 됩니다. 즉 [0, 0.25] 중에서 uniform한 확률로 tau를 sampling하게 됩니다. 결과적으로 risk-averse policy에 따라 action을 선택하게 됩니다.  </p>
<p><br></p>
<h3 id="2-Network"><a href="#2-Network" class="headerlink" title="2. Network"></a>2. Network</h3><p>여기서는 IQN 네트워크의 구조에 대해 살펴보도록 하겠습니다. 일단 위에서 봤던 그림을 다시 한번 살펴보도록 하겠습니다.</p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/unsy98e3xmz4a5n/compare_paper.png?dl=1" alt="Comparison from paper" width="800"><br><br></p>

<p>위의 그림에서 DQN과 IQN만 비교해보도록 하겠습니다. </p>
<p>특정 action a에 대해 DQN은 다음과 같은 함수들로 나타낼 수 있습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/br22t2a08dgz03a/DQN_equation.png?dl=1" alt="DQN" width="300"><br><br></p>

<p>위의 식에서 <strong>psi</strong>는 convolution layers에 의한 연산을, <strong>f</strong>는 fully-connected layers에 의한 연산을 나타냅니다. </p>
<p>IQN도 DQN과 동일한 function인 <strong>psi</strong>와 <strong>f</strong>를 이용합니다. 그 대신 거기에 tau를 embedding 해주는 함수 <strong>phi</strong>를 추가적으로 사용합니다. 이에 따라 특정 action a에 대해 IQN을 함수로 나타낸 것이 다음과 같습니다. </p>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/h6z8ppz9z9tkr8y/IQN_equation.png?dl=1" alt="DQN" width="500"><br><br></p>

<p>위의 식을 살펴보자면 convolution function (psi)를 통해 얻은 결과와 tau에 대한 embedding function (phi)를 통해 얻은 결과를 element-wise하게 곱해줍니다. 그리고 그 결과에 fully-connected layer 연산을 수행하여 최종적으로 action a에 대한 value distribution을 얻습니다.  </p>
<p>즉 위의 그림에서도 볼 수 있듯이 tau를 embedding하는 function인 phi를 제외하고는 모두 DQN과 같다고 할 수 있습니다. 이에 따라 embedding function (phi)에 대해서 한번 살펴보도록 하겠습니다. 이 함수의 역할은 하나의 sampling된 tau를 벡터로 embedding 해주는 것입니다. 본 논문에서 embedding에 대한 function은 다음과 같은 <strong>n cosine basis function</strong> 입니다. </p>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/uxnaqayrxoazj93/embedding.png?dl=1" alt="Embedding" width="600"><br><br></p>

<p>위의 식에서 n은 embedding dimension이며 값은 64로 설정하였습니다. tau는 sampling된 값이며 w와 b는 linear layer 연산을 위한 weight와 bias입니다. 위 수식만을 봐서는 embedding을 어떻게 수행할지 감이 오지 않을 수 있습니다! 하나의  quantile에 대해 어떻게 sampling을 하는지 그림과 함께 예를 들어보도록 하겠습니다. </p>
<ol>
<li>우선 0~1 사이의 서로 다른 값을 [batch size x 1]의 사이즈로  random sampling 합니다. 이 값들은 각각의 tau값을 나타냅니다. </li>
</ol>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/y5gzs2vdpn6qlp3/embedding_progress1.png?dl=1" alt="Embedding progress 1" width="500"><br><br></p>

<ol start="2">
<li><p>[Batch size x 1]로 sampling한 tau들을 복제하여 embedding dimension 만큼 쌓아줍니다. 본 논문의 경우 embedding dimension은 64입니다. 위 과정에 대한 결과의 사이즈는 [batch size x embedding dim]이 됩니다. </p>
<p align="center">

</p></li>
</ol>
<p><img src="https://www.dropbox.com/s/n86yp26tlcovjch/embedding_progress2.png?dl=1" width="600"></p>
<p></p><p></p>
<ol start="3">
<li>모든 [batch size x embedding dim]의 모든 row에 0 ~ (n-1) 을 1씩 증가시킨 값을 곱해줍니다. 그리고 모든 값에 pi를 곱해줍니다. 이렇게 계산한 결과의 dimension은 여전히 [batch size x embedding dim] 입니다. </li>
</ol>
<p align="center"><br><br> <img src="https://www.dropbox.com/s/i1qs8zf162eniuu/embedding_progress3.png?dl=1" alt="Embedding" width="1000"><br><br></p>

<ol start="4">
<li>다음으로는 3의 결과에 cos 연산을 해주고 weight를 곱하고 bias를 더해줍니다. 그리고 해당 결과에 최종적으로 ReLU 함수를 적용해줍니다. 여기서 weight의 사이즈는 [embedding dim x convolution 결과의 크기] 이며 bias의 사이즈는 [convolution 결과의 크기] 입니다. 결국 embedding 연산의 최종 결과는 [batch size x convolution 결과의 크기]가 됩니다. Convolution 연산의 최종 결과 또한 크기가 [batch size x convolution 결과의 크기] 입니다. 이에 따라 둘은 크기가 같아지게 되고 이에 따라 element-wise 하게 곱할 수 있게 됩니다. </li>
</ol>
<p align="center"><br><br><img src="https://www.dropbox.com/s/bnbxq3aj6c5kmrt/embedding_progress4.png?dl=1" alt="Embedding" width="800"><br><br></p>

<p>여기까지가 Embedding function의 내용입니다! </p>
<p>여기서 약간의 의문이 들 수 있을 것이라 생각합니다. 왜 <strong>n cosine basis function</strong>을 이용할까요? 논문에서는 다양한 함수에 대해서 실험을 수행하였고 그 결과 <strong>n cosine basis function</strong>이 가장 좋은 결과를 보였다고 합니다. 여러 함수에 대해 테스트한 결과는 다음과 같습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/09idlykr8xr6fo9/embedding_compare.png?dl=1" alt="Embedding" width="800"><br><br></p>

<p><br></p>
<h3 id="3-Quantile-Huber-Loss"><a href="#3-Quantile-Huber-Loss" class="headerlink" title="3. Quantile Huber Loss"></a>3. Quantile Huber Loss</h3><p>사실 본 논문에서는 QR-DQN에서 사용했던 <strong>Quantile Huber Loss</strong>를 그대로 이용합니다. 하지만 본 논문에서는 식을 다음과 같이 표시합니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/ie5l2z5cwagoj86/loss.png?dl=1" alt="Embedding" width="500"><br><br></p>

<p>본 논문에서 N은 추정을 위해 일반 network 연산에서 sampling한 tau의 수 입니다. N’은 target distribution 도출을 위해 target network 연산에서 sampling한 tau의 수 입니다. 위 식에 대해서는 QR-DQN에서 자세히 설명하였으므로 추가적인 설명은 하지 않도록 하겠습니다. 다만 본 논문에서는 N과 N’를 다양하게 바꿔가면서 테스트한 결과를 다음과 같이 보여줍니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/t2eeof94yhq57gb/various_n.png?dl=1" alt="Various N" width="700"><br><br></p>

<p>위의 결과는 6개의 atari game에 대한 human-normalized agent performance의 평균을 나타냅니다. 왼쪽의 경우 초반 10M frame을 학습하였을 때 결과이며 오른쪽의 경우 마지막 10M frame의 학습 결과입니다. 다른 알고리즘의 경우 각각 왼쪽과 오른쪽에 대한 결과가 다음과 같습니다. </p>
<ul>
<li>DQN: (32, 253)</li>
<li>QR-DQN: (144, 1243)</li>
</ul>
<p><br></p>
<h3 id="4-Action-선택"><a href="#4-Action-선택" class="headerlink" title="4. Action 선택"></a>4. Action 선택</h3><p> 본 논문에서  action을 선택하는 식이 QR-DQN과 비교했을 때 약간의 차이가 있습니다. 해당 식은 다음과 같습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/76l4gi57vasj300/action_equation.png?dl=1" alt="Action equation" width="500"><br><br></p>

<p>위 식은 단순히 sampling된 quantile을 통해 구한 모든 support의 값을 평균한 것입니다. </p>
<p><br></p>
<p> 본 논문의 알고리즘은 다음과 같습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/fbxxlz25l6dunxi/algorithm.png?dl=1" alt="algorithm (IQN)" width="700"><br><br></p>

<p><br></p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>본 알고리즘의 성능은 Atari-57 benchmark를 통해 검증되었습니다. </p>
<p>본 알고리즘에서 설정한 파라미터 값은 다음과 같습니다. </p>
<h3 id="Risk-Sensitive-Policy"><a href="#Risk-Sensitive-Policy" class="headerlink" title="Risk Sensitive Policy"></a>Risk Sensitive Policy</h3><p>우선 Risk의 정도를 다양하게 한 결과가 아래와 같습니다. </p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/8bcsng48ywep3ay/sampling_distribution_result.png?dl=1" alt="Risk compare result" width="1000"><br><br></p>

<p>위의 결과에서 보면 CPW(.71)과 Norm(3)의 경우 distribution의 양 끝부분에 대한 영향을 감소시킵니다. Wang(.75)의 경우 Risk-seeking, Wang(-.75), Pow(-2), CVaR(.25) 그리고 CVaR(.1)의 경우 Risk-averse 한 policy를 선택합니다. </p>
<p>위의 결과를 비교해보면 다음과 같은 순서대로 우수한 성능을 보입니다. </p>
<p>Risk-averse &gt; Neutral &gt; Risk-seeking </p>
<p>이에 대해서는 대부분의 게임이 오래 살아있을 수록 받는 reward가 증가하기 때문에 불확실하면서 높은 reward를 선택하는 risk-seeking policy보다 작더라도 안정적인 reward를 선택하는 risk-averse policy가 좋은 성능을 보이는 것이라 생각할 수 있습니다. </p>
<p><br></p>
<h3 id="Atari-57-Result"><a href="#Atari-57-Result" class="headerlink" title="Atari-57 Result"></a>Atari-57 Result</h3><p>IQN 알고리즘을 57개의 Atari game에 테스트한 결과가 다음과 같습니다. </p>
<p align="center"><br><img src="https://www.dropbox.com/s/p530cm694ey9v0h/Result1.png?dl=1" alt="Result1" width="600"><br><br></p>

<p align="center"><br><img src="https://www.dropbox.com/s/p4v7brznezqo4lk/Result2.png?dl=1" alt="Result2" width="600"><br><br></p>

<p>위의 결과에서 볼 수 있듯이 IQN은 단일 알고리즘임에도 불구하고 여러가지 기법을 조합한 Rainbow에 약간 못미치는 성능을 보입니다. 하지만 다른 단일 알고리즘인 Prioritized experience replay, C51, QR-DQN에 비해서는 모두 우수한 성능을 보이고 있습니다. 특히 QR-DQN에 비해 많은 변화가 없음에도 불구하고 기존의 단일 알고리즘 중 가장 좋은 성능을 보였던 QR-DQN보다 월등히 우수한 성능을 보이고 있습니다. </p>
<p><br></p>
<h3 id="Robustness-Test"><a href="#Robustness-Test" class="headerlink" title="Robustness Test"></a>Robustness Test</h3><p>다음의 결과는 같이 작업을 수행한 <code>윤승제</code>님께서 테스트해주신 결과입니다. Cartpole을 기본 파라미터로 학습을 수행한 후 <strong>Pole의 길이</strong>와 <strong>Pole의 질량</strong>을 다양하게 변경해가면서 테스트를 수행하였습니다. 알고리즘은 DQN과 IQN의 결과를 비교하였습니다.</p>
<p align="center"><br><br><img src="https://www.dropbox.com/s/wbvlmmc8oudw4kb/robustness.png?dl=1" alt="Result_robustness" width="800"><br><br></p>

<p>까맣게 될수록 500점을 내지 못하고 중간에 떨어진 것입니다. 위의 결과에서 볼 수 있듯이 DQN은 파라미터의 변화에 취약하여 값을 변경하는 것에 따라 성능이 크게 저하되는 것을 확인할 수 있었습니다. 하지만 IQN의 경우 파라미터 변화에 매우 robust하여 parameter가 변해도 대부분의 경우 500점을 얻는 것을 확인할 수 있었습니다. </p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>IQN은 QR-DQN에 비해 다음의 사항들만 변경해줬음에도 불구하고 훨씬 뛰어난 성능을 보이는 알고리즘입니다.  </p>
<ul>
<li>Quantile을 random sampling하고 그때의 support를 도출하여 value distribution 취득</li>
<li>Random sampling을 이용하여 risk-sensitive policy에 따른 action 선택 가능</li>
<li>Network의 구조 변화 (DQN과 동일하나 convolution 연산의 결과를 embedding function 결과와 element-wise하게 곱해줌) </li>
</ul>
<p><br></p>
<p>IQN의 경우 다양한 deep reinforcement learning 알고리즘들에 비해 좋은 성능을 보였으며 특히 단일 알고리즘임에도 불구하고 여러 알고리즘의 결합체인 Rainbow에 약간 못미치는 성능을 보였습니다. 또한 quantile regression을 이용하여 wasserstein distance를 줄이는 만큼 distributional RL의 수렴성을 증명했다는 QR-DQN의 장점은 그대로 가지고 있는 알고리즘이라 할 수 있습니다. </p>
<p><br></p>
<p>IQN을 끝으로 Deepmind에서 현재까지 (2018.11.01) 발표한 distributional RL에 대한 논문들에 대한 리뷰를 마치도록 하겠습니다!! 감사합니다!! :smile:</p>
<p><br></p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>본 논문의 코드는 다음의 Github를 참고해주세요. </p>
<p><a href="https://github.com/reinforcement-learning-kr/distributional_rl" target="_blank" rel="noopener">Github</a></p>
<p><br></p>
<h2 id="Other-Posts"><a href="#Other-Posts" class="headerlink" title="Other Posts"></a>Other Posts</h2><p><a href="https://reinforcement-learning-kr.github.io/2018/09/27/Distributional_intro/">Distributional RL 개요</a></p>
<p><a href="https://reinforcement-learning-kr.github.io/2018/10/02/C51/">C51</a></p>
<p><a href="https://reinforcement-learning-kr.github.io/2018/10/22/QR-DQN/">QR-DQN</a></p>
<p><br></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://arxiv.org/abs/1806.06923" target="_blank" rel="noopener">Implicit Quantile Networks for Distributional Reinforcement Learning</a></li>
</ul>
<p><br></p>
<h2 id="Team"><a href="#Team" class="headerlink" title="Team"></a>Team</h2><p>민규식: <a href="https://github.com/Kyushik" target="_blank" rel="noopener">Github</a>, <a href="https://www.facebook.com/kyushik.min" target="_blank" rel="noopener">Facebook</a></p>
<p>차금강: <a href="https://github.com/chagmgang" target="_blank" rel="noopener">Github</a>, <a href="https://www.facebook.com/profile.php?id=100002147815509" target="_blank" rel="noopener">Facebook</a></p>
<p>윤승제: <a href="https://github.com/sjYoondeltar" target="_blank" rel="noopener">Github</a>, <a href="https://www.facebook.com/seungje.yoon" target="_blank" rel="noopener">Facebook</a></p>
<p>김하영: <a href="https://github.com/hayoung-kim" target="_blank" rel="noopener">Github</a>, <a href="https://www.facebook.com/altairyoung" target="_blank" rel="noopener">Facebook</a></p>
<p>김정대: <a href="https://github.com/kekmodel" target="_blank" rel="noopener">Github</a>, <a href="https://www.facebook.com/kekmodel" target="_blank" rel="noopener">Facebook</a></p>


				
			</div>

			<!-- Comments -->
			
				<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
					
    <hr />
    <h3>Comments:</h3>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>



				</div>
			
		</div>
	</div>
</article>

<!-- S 디스쿼스 주석처리 웅원이가 꺼달라그럼 2018.05.10 보미 -->
<div id="disqus_thread"></div>
<script>
	

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
// (function() { // DON'T EDIT BELOW THIS LINE
// var d = document, s = d.createElement('script');
// s.src = 'https://bomee88.disqus.com/embed.js';
// s.setAttribute('data-timestamp', +new Date());
// (d.head || d.body).appendChild(s);
// })();
</script>
<!-- <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->

<!-- E 디스쿼스 추가함 2018.04.09 보미-->

    <!-- Footer -->
    <!-- Footer -->
<footer>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<ul class="list-inline text-center">
					

					

					
						<li>
							<a href="https://github.com/reinforcement-learning-kr" target="_blank">
								<span class="fa-stack fa-lg">
									<i class="fa fa-circle fa-stack-2x"></i>
									<i class="fa fa-github fa-stack-1x fa-inverse"></i>
								</span>
							</a>
						</li>
					

					

					
						<li>
							<a href="mailto:rlkorea7@gmail.com" target="_blank">
								<span class="fa-stack fa-lg">
									<i class="fa fa-circle fa-stack-2x"></i>
									<i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
								</span>
							</a>
						</li>
					

					
				</ul>
				<p class="copyright text-muted">&copy; 2019 Bomi Yu</p>
			</div>
		</div>
	</div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="/js/customizing.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Highlight -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments //디스쿼스 새로운 js삽입 2018.04.09 보미-->
<script id="dsq-count-scr" src="//bomee88.disqus.com/count.js" async></script>

<!-- // mathJax 추가 2018.05.29 보미 -->
<!-- // mathJax 수정 2018.06.15 웅원 -->
<!--
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
-->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$']]
    }
  });
</script>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML">
</script>
                          

<script type="text/javascript">
    var disqus_shortname = 'rlkorea';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>

</html>